<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Visualisations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280;--accent:#2563eb;--radius:10px;--pad:14px;--maxw:1100px}
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#111}
    .page{max-width:var(--maxw);margin:28px auto;padding:18px;box-sizing:border-box}
    h3{margin:0 0 12px}
    .grid{display:grid;grid-template-columns:1fr;gap:18px}
    @media(min-width:1000px){.grid{grid-template-columns:1fr 360px}}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:var(--pad);box-sizing:border-box}
    label{display:block;margin:8px 0 6px;font-weight:600}
    textarea,input,select,button{font:inherit;padding:8px;border:1px solid #e6e6e6;border-radius:8px}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .chart{width:100%;height:320px}
    .muted{color:var(--muted);font-size:13px}
    .compact{font-size:13px;color:var(--muted)}
    .btn-primary{background:linear-gradient(180deg,var(--accent),#1e40af);color:#fff;border:0;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    .btn-ghost{background:transparent;color:#111;border:1px solid #e6e6e6;padding:8px 12px;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>
  <div class="page">
    <h3>Visualisations</h3>

    <div class="grid">
      <div class="card">
        <label>Data input</label>
        <div class="muted compact">Numeric mode: histogram & box plot. Paired mode: scatter. Use commas, spaces, or newlines.</div>

        <label style="margin-top:10px">Raw data</label>
        <textarea id="rawInput" style="height:120px">12,15,13,15,20,18,29,19,
23,13,14,15,16,28,30,29,
22,22,21</textarea>

        <div class="controls" style="margin-top:10px">
          <label class="compact">Mode
            <select id="mode" style="margin-left:8px">
              <option value="numeric">Numeric (histogram & box plot)</option>
              <option value="paired">Paired (scatter only)</option>
            </select>
          </label>

          <label class="compact">Bins
            <input id="bins" type="number" min="1" max="200" value="12" style="width:90px;margin-left:8px" />
          </label>

          <label class="compact"><input id="autoBins" type="checkbox" checked /> Auto bins</label>

          <label class="compact"><input id="plotPoints" type="checkbox" /> Plot points (box)</label>

          <button id="renderBtn" class="btn-primary">Render</button>
        </div>

        <div style="margin-top:12px" class="compact" id="stats">Count: — ; Min: — ; Max: — ; Mean: —</div>
      </div>

      <div class="card">
        <label>Scatter quick filter</label>
        <div class="muted compact">Filter scatter by ranges (min,max). Leave empty to skip.</div>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          <input id="xrange" placeholder="minX,maxX" style="width:140px" />
          <input id="yrange" placeholder="minY,maxY" style="width:140px" />
          <button id="applyFilter" class="btn-ghost">Apply Filter</button>
          <button id="clearFilter" class="btn-ghost">Clear</button>
        </div>
      </div>

      <div class="card" style="grid-column:1/-1">
        <label>Histogram</label>
        <div id="hist" class="chart" role="img" aria-label="Histogram"></div>
      </div>

      <div class="card">
        <label>Box plot</label>
        <div id="box" class="chart" role="img" aria-label="Box plot"></div>
      </div>

      <div class="card">
        <label>Scatter plot</label>
        <div id="scatter" class="chart" role="img" aria-label="Scatter plot"></div>
      </div>
    </div>
  </div>

  <script>
  // Parsers and helpers
  function parseNumbers(text) {
    if (!text) return [];
    const tokens = text.split(/[,;\n\r\s]+/).map(t => t.trim()).filter(Boolean);
    return tokens.map(t => Number(t)).filter(n => Number.isFinite(n));
  }

  function parsePairs(text) {
    if (!text) return [];
    const normalized = text.replace(/\r/g,' ').replace(/\n/g,' ').trim();
    const tokens = normalized.split(/\s+/).filter(Boolean);
    const pts = [];
    for (const tok of tokens) {
      if (tok.includes(',')) {
        const [a,b] = tok.split(',').map(s=>s.trim());
        const x = Number(a), y = Number(b);
        if (Number.isFinite(x) && Number.isFinite(y)) pts.push({x,y});
      }
    }
    if (pts.length) return pts;
    const nums = parseNumbers(text);
    for (let i=0;i+1<nums.length;i+=2) pts.push({x:nums[i], y:nums[i+1]});
    return pts;
  }

  function mean(arr){ return arr.length ? arr.reduce((s,v)=>s+v,0)/arr.length : null; }

  function computeBins(values, requestedBins, auto) {
    if (!values.length) return {bins:[],counts:[],edges:[]};
    const min = Math.min(...values), max = Math.max(...values);
    if (min === max) return {bins:[String(min)],counts:[values.length],edges:[min,max]};
    let binCount = Math.max(1, Math.floor(requestedBins || 10));
    if (auto) {
      const sorted = values.slice().sort((a,b)=>a-b);
      const q1 = sorted[Math.floor((sorted.length-1)*0.25)];
      const q3 = sorted[Math.floor((sorted.length-1)*0.75)];
      const iqr = q3 - q1 || (max - min) / 2;
      const h = Math.max((2 * iqr) / Math.cbrt(values.length), (max - min) / 10);
      binCount = Math.max(1, Math.round((max - min) / h));
    }
    const width = (max - min) / binCount;
    const edges = Array.from({length:binCount+1}, (_,i) => min + i*width);
    const counts = new Array(binCount).fill(0);
    for (const v of values) {
      let idx = Math.floor((v - min) / width);
      if (idx === binCount) idx = binCount - 1;
      counts[idx]++;
    }
    const labels = edges.slice(0,-1).map((e,i)=>`${Number(e.toFixed(6))}–${Number(edges[i+1].toFixed(6))}`);
    return {bins:labels,counts,edges};
  }

  // Plotting
  function renderAll() {
    const raw = document.getElementById('rawInput').value || '';
    const mode = document.getElementById('mode').value;
    const autoBins = document.getElementById('autoBins').checked;
    const binsReq = Math.max(1, Number(document.getElementById('bins').value) || 12);
    const plotPoints = document.getElementById('plotPoints').checked;

    if (mode === 'numeric') {
      const nums = parseNumbers(raw);
      document.getElementById('stats').textContent = nums.length
        ? `Count: ${nums.length}; Min: ${Math.min(...nums)}; Max: ${Math.max(...nums)}; Mean: ${mean(nums).toFixed(2)}`
        : 'No numeric data';

      // Histogram
      const histTrace = { x: nums, type: 'histogram', marker:{color:'rgba(58,123,213,0.8)'}, opacity:0.9 };
      if (!autoBins) histTrace.nbinsx = binsReq;
      Plotly.react('hist', [histTrace], {margin:{t:30,l:50,r:20,b:50}, xaxis:{title:'Value'}, yaxis:{title:'Count'}, title:'Histogram'}, {responsive:true});

      // Box
      const boxTrace = { y: nums, type: 'box', boxpoints: plotPoints ? 'all' : 'outliers', marker:{color:'rgba(16,185,129,0.9)'} };
      Plotly.react('box', [boxTrace], {margin:{t:30,l:50,r:20,b:50}, yaxis:{title:'Value'}, title:'Box plot'}, {responsive:true});

      // Scatter cleared (no paired data)
      Plotly.react('scatter', [{ x:[], y:[], mode:'markers', type:'scatter' }], {margin:{t:20,b:40}, title:'Scatter (use Paired mode)'}, {responsive:true});
    } else {
      // Paired mode -> scatter
      const pts = parsePairs(raw);
      document.getElementById('stats').textContent = `Points: ${pts.length}`;
      Plotly.react('scatter', [{ x: pts.map(p=>p.x), y: pts.map(p=>p.y), mode:'markers', marker:{size:8,color:'rgba(234,88,12,0.9)'} }], {margin:{t:30,l:50,r:20,b:50}, xaxis:{title:'X'}, yaxis:{title:'Y'}, title:'Scatter Plot'}, {responsive:true});

      // Clear histogram/box when paired mode
      Plotly.react('hist', [{ x:[], type:'histogram' }], {margin:{t:20,b:40}, title:'Histogram (numeric mode)'}, {responsive:true});
      Plotly.react('box', [{ y:[], type:'box' }], {margin:{t:20,b:40}, title:'Box plot (numeric mode)'}, {responsive:true});
    }
  }

  // Scatter filter
  function applyScatterFilter() {
    const raw = document.getElementById('rawInput').value || '';
    const pts = parsePairs(raw);
    if (!pts.length) return;
    const xr = document.getElementById('xrange').value.split(',').map(s=>Number(s.trim())).filter(n=>Number.isFinite(n));
    const yr = document.getElementById('yrange').value.split(',').map(s=>Number(s.trim())).filter(n=>Number.isFinite(n));
    let filtered = pts.slice();
    if (xr.length === 2) filtered = filtered.filter(p => p.x >= xr[0] && p.x <= xr[1]);
    if (yr.length === 2) filtered = filtered.filter(p => p.y >= yr[0] && p.y <= yr[1]);
    Plotly.react('scatter', [{ x: filtered.map(p=>p.x), y: filtered.map(p=>p.y), mode:'markers', marker:{size:8,color:'rgba(234,88,12,0.9)'} }], {margin:{t:30,l:50,r:20,b:50}, xaxis:{title:'X'}, yaxis:{title:'Y'}, title:`Scatter (filtered: ${filtered.length})`}, {responsive:true});
  }

  function clearScatterFilter() {
    document.getElementById('xrange').value = '';
    document.getElementById('yrange').value = '';
    renderAll();
  }

  // Events
  document.getElementById('renderBtn').addEventListener('click', renderAll);
  document.getElementById('applyFilter').addEventListener('click', applyScatterFilter);
  document.getElementById('clearFilter').addEventListener('click', clearScatterFilter);
  document.getElementById('rawInput').addEventListener('keydown', e => { if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); renderAll(); } });

  // initial render
  renderAll();
  </script>

<a href="index.html" style="
  display:inline-block;
  margin-top:24px;
  background:linear-gradient(180deg,#2563eb,#1e40af);
  color:#fff;
  padding:12px 18px;
  border-radius:999px;
  text-decoration:none;
  font-weight:700;
  box-shadow:0 6px 18px rgba(37,99,235,0.18);
">
  ← Back to Main Page
</a>

</body>
</html>